<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta charset="utf-8"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
     <style>
        #tools {
          position: absolute;
          top: 1rem;
          right: 1rem;
        }
        #tools a {
          display: inline-block;
          padding: 0.5rem;
          background: white;
          cursor: pointer;
        }
      </style>
</head>
<body>
    <div id="mapdiv"></div>
    <div id="tools">
        <a id="clear">Select</a>
    </div>
    <h1>Select location by recorder</h1>
    <form action="/action_page.php">
        <label for="fname">Recorder Name: </label>
        <input type="text" id="fname" name="fname"><br><br>
        <input type="submit" value="Submit">
    </form>
 

    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=fetch,requestAnimationFrame,Element.prototype.classList,URL"></script>
    <script src="http://www.openlayers.org/api/OpenLayers.js"></script>
    <script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script>

        $.getJSON('/api/data', function(data) {
            console.log(data[0].recorder);
            console.log(data[0].gender);
            console.log(data[0].transit);
            console.log(data[0].longitude);
            console.log(data[0].latitude);
            
            var veri1=data[0].longitude;
            var veri2=data[0].latitude;

            map = new OpenLayers.Map("mapdiv");
            map.addLayer(new OpenLayers.Layer.OSM());
            
            var point;
            var length=data.length;
            var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
            //TODO - data haritaya ekleme i≈ülemi
            for (point = 0; point < data.length; point++) {
            var rec=data[point].recorder;
            var gen=data[point].gender;
            var tra=data[point].transit;
            var lon=data[point].longitude;
            var lat=data[point].latitude;

            var lonLat = new OpenLayers.LonLat(lon,lat ).transform(new OpenLayers.Projection("EPSG:4326"), // transform from WGS 1984
                                                                map.getProjectionObject() // to Spherical Mercator Projection
                                                                )
            var zoom=10;
        
            var markers = new OpenLayers.Layer.Markers("Markers");
            var marker_colour = new OpenLayers.Layer.Markers("Markers");
        if (tra=='Dolmus') {
                marker_colour = 'https://cdn-icons-png.flaticon.com/512/1165/1165961.png';
        } else if(tra=='Bus'){ marker_colour='https://cdn-icons-png.flaticon.com/512/808/808338.png'}
        else{marker_colour = 'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/1b79e5b0-91c9-477c-a5ed-e69c443dd9d6/d843e7y-902fe748-6a66-404b-a65e-b0c31581a7d3.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiJcL2ZcLzFiNzllNWIwLTkxYzktNDc3Yy1hNWVkLWU2OWM0NDNkZDlkNlwvZDg0M2U3eS05MDJmZTc0OC02YTY2LTQwNGItYTY1ZS1iMGMzMTU4MWE3ZDMucG5nIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.cBdDsotPxb7z_MrTAWGiZnUHAB_1xz0310fMFS2tRkQ'}
            markers.addMarker(new OpenLayers.Marker(lonLat))
                
            map.setCenter(lonLat,zoom)
                
        var feature = new OpenLayers.Feature.Vector(
        new OpenLayers.Geometry.Point( lon,lat ).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject()),
        {description:'Latitude: '+lat+'<br>Longitude: '+lon+'<br>Recorder: '+rec+'<br>Recorder Gender: '+gen+'<br>Transit Type: '+tra},
        {externalGraphic: marker_colour, graphicHeight: 60, graphicWidth: 60, graphicXOffset:-20, graphicYOffset:-30 }
        );

        vectorLayer.addFeatures(feature);
        map.addLayer(vectorLayer);
                
            var controls = {
              selector: new OpenLayers.Control.SelectFeature(vectorLayer, { onSelect: createPopup, onUnselect: destroyPopup })
            };

            function createPopup(feature) {
              feature.popup = new OpenLayers.Popup.FramedCloud("pop",
                  feature.geometry.getBounds().getCenterLonLat(),
                  null,
                  '<div class="markerContent">'+feature.attributes.description+'</div>',
                  null,
                  true,
                  function() { controls['selector'].unselectAll(); }
              );
             
              map.addPopup(feature.popup);
            }

            function destroyPopup(feature) {
              feature.popup.destroy();
              feature.popup = null;
            }

            map.addControl(controls['selector']);
            controls['selector'].activate();

            }


        });
     
    </script>
    
  </body>
  </html>
